<div id="memory_summarize_settings" class="qvink_memory_settings_content">
    <div class="inline-drawer">
        <div class="inline-drawer-toggle inline-drawer-header">
            <b>Memory Summarize</b>
            <div class="inline-drawer-icon fa-solid fa-circle-chevron-down down"></div>
        </div>
        <div class="inline-drawer-content">

            <!-- Main Settings -->
            <div style="margin: 10px 0;">
                <h3><i class="fa-solid fa-sliders"></i> Main Settings</h3>

                <label class="checkbox_label" for="memory_summarize_enabled">
                    <input id="memory_summarize_enabled" type="checkbox" />
                    <span>Enable Memory Summarize</span>
                </label>
                <small class="notes">Master switch for the entire extension</small>

                <label class="checkbox_label marginTop10" for="memory_summarize_auto">
                    <input id="memory_summarize_auto" type="checkbox" />
                    <span>Auto-Summarize Messages</span>
                </label>
                <small class="notes">Automatically summarize messages as they arrive</small>

                <label class="checkbox_label marginTop10" for="memory_summarize_display">
                    <input id="memory_summarize_display" type="checkbox" />
                    <span>Display Summaries on Messages</span>
                </label>
                <small class="notes">Show inline summaries beneath messages in chat</small>
            </div>

            <hr>

            <!-- Threshold Settings -->
            <div style="margin: 10px 0;">
                <h3><i class="fa-solid fa-gauge-high"></i> Thresholds</h3>

                <label for="memory_summarize_threshold">
                    <small>Message Threshold</small>
                </label>
                <input id="memory_summarize_threshold" class="text_pole" type="number" min="1" max="1000" />
                <small class="notes">Start auto-summarizing after this many messages</small>

                <label for="memory_summarize_lag" class="marginTop10">
                    <small>Message Lag</small>
                </label>
                <input id="memory_summarize_lag" class="text_pole" type="number" min="0" max="50" />
                <small class="notes">Don't summarize the last N messages (keeps recent context fresh)</small>
            </div>

            <hr>

            <!-- Message Types -->
            <div style="margin: 10px 0;">
                <h3><i class="fa-solid fa-filter"></i> Message Types to Summarize</h3>

                <label class="checkbox_label" for="memory_summarize_include_character">
                    <input id="memory_summarize_include_character" type="checkbox" />
                    <span>Character Messages</span>
                </label>

                <label class="checkbox_label marginTop10" for="memory_summarize_include_user">
                    <input id="memory_summarize_include_user" type="checkbox" />
                    <span>User Messages</span>
                </label>

                <label class="checkbox_label marginTop10" for="memory_summarize_include_system">
                    <input id="memory_summarize_include_system" type="checkbox" />
                    <span>System Messages</span>
                </label>
                <small class="notes">Select which message types should be summarized</small>
            </div>

            <hr>

            <!-- Prompt Configuration -->
            <div style="margin: 10px 0;">
                <h3><i class="fa-solid fa-message"></i> Summary Prompt</h3>

                <label for="memory_summarize_prompt">
                    <small>Summarization Prompt</small>
                </label>
                <textarea id="memory_summarize_prompt" class="text_pole textarea_compact" rows="4" placeholder="Enter the prompt used to generate summaries..."></textarea>
                <small class="notes">Use {{message}} as a placeholder for the message content</small>
            </div>

            <hr>

            <!-- Memory Template -->
            <div style="margin: 10px 0;">
                <h3><i class="fa-solid fa-file-code"></i> Injection Template</h3>

                <label for="memory_summarize_template">
                    <small>Memory Injection Template</small>
                </label>
                <textarea id="memory_summarize_template" class="text_pole textarea_compact" rows="3" placeholder="Template for injecting memories into context..."></textarea>
                <small class="notes">Use {{memories}} as a placeholder for the summarized memories. This is injected into the prompt.</small>
            </div>

            <hr>

            <!-- Advanced Options -->
            <div style="margin: 10px 0;">
                <h3><i class="fa-solid fa-gear"></i> Advanced Options</h3>

                <label class="checkbox_label" for="memory_summarize_batch">
                    <input id="memory_summarize_batch" type="checkbox" />
                    <span>Batch Summarize</span>
                </label>
                <small class="notes">Summarize multiple messages at once (may take longer)</small>

                <label class="checkbox_label marginTop10" for="memory_summarize_debug">
                    <input id="memory_summarize_debug" type="checkbox" />
                    <span>Debug Mode</span>
                </label>
                <small class="notes">Enable console logging for debugging</small>
            </div>

            <hr>

            <!-- Bulk Actions -->
            <div style="margin: 10px 0;">
                <h3><i class="fa-solid fa-bolt"></i> Bulk Actions</h3>

                <div class="flex-container flexnowrap">
                    <button id="memory_summarize_all" class="menu_button flex1">
                        <i class="fa-solid fa-wand-magic-sparkles"></i>
                        <span>Summarize All Messages</span>
                    </button>
                </div>

                <div class="flex-container flexnowrap marginTop10">
                    <button id="memory_summarize_clear_all" class="menu_button caution flex1">
                        <i class="fa-solid fa-trash-can"></i>
                        <span>Clear All Summaries</span>
                    </button>
                </div>

                <small class="notes">⚠️ Bulk actions may take time and cannot be undone</small>
            </div>

            <hr>

            <!-- Info Section -->
            <div style="margin: 10px 0;">
                <h3><i class="fa-solid fa-circle-info"></i> How to Use</h3>
                <div style="background: var(--black30a); padding: 10px; border-radius: 5px; margin-top: 5px;">
                    <p style="margin: 5px 0;"><strong>Automatic Mode:</strong></p>
                    <ul style="margin: 5px 0; padding-left: 20px;">
                        <li>Enable "Auto-Summarize" and set your threshold</li>
                        <li>Messages will be automatically summarized as you chat</li>
                        <li>Summaries are injected into the prompt context</li>
                    </ul>

                    <p style="margin: 10px 0 5px 0;"><strong>Manual Mode:</strong></p>
                    <ul style="margin: 5px 0; padding-left: 20px;">
                        <li>Click the <i class="fa-solid fa-brain"></i> icon on any message to summarize it</li>
                        <li>Click an existing summary to edit it</li>
                        <li>Use slash commands: <code>/summarize &lt;index&gt;</code> or <code>/summarize-all</code></li>
                    </ul>

                    <p style="margin: 10px 0 5px 0;"><strong>Tips:</strong></p>
                    <ul style="margin: 5px 0; padding-left: 20px;">
                        <li>Higher message lag keeps recent context more detailed</li>
                        <li>Customize the summary prompt for different summary styles</li>
                        <li>Use batch mode for processing long chats at once</li>
                    </ul>
                </div>
            </div>

            <!-- Version Info -->
            <div style="margin: 15px 0; text-align: center; opacity: 0.7;">
                <small>Memory Summarize v2.0.0 - Enhanced for SillyTavern 1.13+</small>
            </div>

        </div>
    </div>
</div>

<style>
    #memory_summarize_settings .inline-drawer-content {
        padding: 10px;
    }

    #memory_summarize_settings h3 {
        margin: 10px 0 10px 0;
        font-size: 1.1em;
        color: var(--SmartThemeBodyColor);
    }

    #memory_summarize_settings h3 i {
        margin-right: 8px;
        opacity: 0.8;
    }

    #memory_summarize_settings .notes {
        display: block;
        margin-top: 5px;
        opacity: 0.7;
        font-style: italic;
    }

    #memory_summarize_settings hr {
        margin: 15px 0;
        border: none;
        border-top: 1px solid var(--SmartThemeBorderColor);
        opacity: 0.3;
    }

    #memory_summarize_settings .caution {
        background: var(--crimson70a);
    }

    #memory_summarize_settings .caution:hover {
        background: var(--crimson);
    }

    #memory_summarize_settings code {
        background: var(--black50a);
        padding: 2px 6px;
        border-radius: 3px;
        font-family: 'Courier New', monospace;
        font-size: 0.9em;
    }

    #memory_summarize_settings ul {
        line-height: 1.6;
    }

    #memory_summarize_settings textarea {
        font-family: 'Courier New', monospace;
        font-size: 0.9em;
    }

    .marginTop10 {
        margin-top: 10px;
    }
</style>
